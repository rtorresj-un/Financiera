---
title: "Parcial 1 - Econometría Financiera"
subtitle: "Raúl Esteban Torres Jiménez & Juanita Cortés Arroyo"
output: pdf_document
---

1. Sustente y explique su respuesta frente a las siguientes preguntas.
  
  1. ¿Cómo se define un mercado eficiente? Defina las tres formas de la hipótesis usando elementos teóricos y matemáticos. Para ello describa las fórmulas de precios y retornos.
  
  2. Suponga que los directores ejecutivos de Ecopetrol (quienes tienen acciones de la empresa y las transan en bolsa) obtienen rendimientos anormalmente altos en las acciones de su propia empresa. ¿Esto invalidaría la hipótesis de mercados eficientes?
  Los retornos anormales que presentan los ejecutivos de Ecopetrol están asociados al conjunto de información que manejan sobre la empresa, con respecto a la mayoría de los agentes que tranzan sus acciones en el mercado. Entonces, los directores ejecutivos tienen a su disposición información privada, lo que les brinda ventajas en términos informacionales en comparación al segmento del mercado que solo puede acceder a la información pública. 
        
  Luego, es evidente que los directores ejecutivos pueden incorporar una mayor cantidad de información a sus decisiones de inversión, y al conocer información relevante a priori, pueden anticiparse a cambios en los precios de la acción. Por lo tanto, se puede establecer que la anormalidad de los retornos no se presenta por la ineficiencia del mercado, sino por la asimetría en el conjunto de información. 
        
  En conclusión, el hecho de que los directores ejecutivos de Ecopetrol obtengan mayores rendimientos en sus inversiones en la empresa, no invalida la hipótesis de mercados eficientes. 

  3. ¿El precio pagado por un inversionista en el mercado por una acción es un precio justo? Discuta su respuesta.
        
  Suponiendo un mercado bajo competencia perfecta, libre acceso a la información y sin costos de transacción, se puede establecer que los precios de mercado siempre reflejan el valor fundamental de un activo, en otras palabras, bajo la hipótesis de mercados informacionalmente eficientes, el precio refleja el valor presente de los flujos futuros de dinero que representa la tenencia de una acción. Así, dados los supuestos enunciados, los precios del mercado eficiente no se pueden pronosticar. 
       
  En este sentido, el precio que paga un inversionista por una acción del mercado no obedece a un criterio de justicia sino de eficiencia, ya que la interacción descentralizada de la oferta y la demanda, que es la que genera los precios, no es moral porque no es ni predecible y tampoco perturbable por los inversionistas.

  4. Si el mercado es eficiente, ¿cuál es el rendimiento esperado para un activo en ese mercado?
        
  El rendimiento en un mercado se puede definir como $R_t=\mu_t + \varepsilon_t$, donde $\mu_t=E[R_t]$ es la prima por riesgo del mercado en un momento \textit{t}, y $\varepsilon_t$ es la componente aleatoria del rendimiento.
        
  Bajo la condición más fuerte de la hipótesis de mercados eficientes, no debería haber primas por riesgo en los mercados, ya que se tiene certeza sobre lo que pueda ocurrir a los mercados.
        
  depende del conjunto de información que se tome, eg martin gala es el precio anterior y en la hipotesis fuerte es 0 dado que se conoce toda la información dsiponible.

  5. Suponga que un inversionista ha descubierto que la raíz cuadrada de cualquier precio de acción multiplicada por el día del mes proporciona un indicador de la dirección en el movimiento del precio de esa acción en particular con una probabilidad del 75\%. ¿En este caso se estaría violando la hipótesis de mercado eficiente?
        
Si una persona es capaz de predecir retornos superiores a los del mercado con una mayor probabilidad, los demás agentes también estarían en la capacidad de hacerlo, dado que son perfectamente racionales y disponen del mismo conjunto de información. Así, cualquier oportunidad de arbitraje que se presente en el mercado se disipará rapidamente, ya que los agentes en conjunto percibirán la sobrevaloración (o subvaloración) de los activos. En este caso, la hipótesis de eficiencia en los mercados no se viola, puesto que los precios volverían a ser impredecibles aún en el caso donde se incorpore información adicional.

2. Obtenga datos diarios y mensuales de cualquier índice accionario de bolsa para un periodo no inferior a 20 años. Con esta información realice los siguientes análisis:

  1. Discuta qué mide el índice accionario elegido y realice un análisis estadístico del mismo y de sus retornos.
    
  El índice accionario \textbf{FTSE100} es un índice de capitalización ponderado de las 100 acciones más capitalizadas que se transan en la \textit{London Stock Exchange}. Este índice sirve como referencia para medir en promedio el rendimiento de las empresas británicas más importantes y está constituido por HSBC, Standard Chatered, Unilever, Glencore, entre otras.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2); library(ggfortify); library(quantmod); library(gridExtra); library(forecast); library(cowplot); library(urca); library(timeDate); library(TSstudio); library(fBasics); library(randtests); library(vrtest)
```

  En primer lugar, obtenemos los datos de precios de cierre de los últimos 5 años S\&P500 Index de Yahoo Finance según las frecuencias requeridas, es decir, diaria, mensual y semanal.

```{r , message=FALSE, warning=FALSE, results='hide'}
getSymbols('^FTSE',from = "1985-01-01", to = "2021-04-29", periodicity = "daily")
UK_d_p <-Cl(FTSE)
getSymbols('^FTSE', from = "1985-01-01", to = "2021-04-29", periodicity = "monthly")
UK_m_p <-Cl(FTSE)
```

  Luego, procedemos a calcular los retornos continuos de los precios para cada serie.

```{r}
UK_d_r <- data.frame(apply(UK_d_p, 2, function(x) Delt(x, type = "log")),
                        fecha = index(UK_d_p))
UK_d_r<-na.omit(UK_d_r)
```

```{r}
UK_m_r <- data.frame(apply(UK_m_p, 2, function(x) Delt(x, type = "log")),
                        fecha = index(UK_m_p))
UK_m_r<-na.omit(UK_m_r)
```

  Al graficar los dos tipos de retornos y compararlos con los precios observamos que a diferencia de los precios, los retornos fluctúan alrededor de una media de cero, sin tener una volatilidad constante.

```{r echo=FALSE, fig.pos='h'}
grid.arrange(
ggplot(UK_d_p)+geom_line(aes(index(UK_d_p), FTSE.Close))+ggtitle("Precios diarios de FTSE100 Index")+xlab('')+ylab(''),
ggplot(UK_d_r)+geom_line(aes(fecha, FTSE.Close))+ggtitle("Log-retornos diarios de FTSE100 Index")+xlab('')+ylab(''),
ggplot(UK_m_p)+geom_line(aes(index(UK_m_p), FTSE.Close))+ggtitle("Precios mensuales de FTSE100 Index")+xlab('')+ylab(''),
ggplot(UK_m_r)+geom_line(aes(fecha, FTSE.Close))+ggtitle("Log-retornos mensuales de FTSE100 Index") + ylab('')+ xlab(''),
nrow= 2)
```

```{r echo=FALSE}
UK_d_r<-UK_d_r[,1]; UK_m_r<-UK_m_r[,1]
stats_d<-basicStats(UK_d_r)[c("Mean", "Stdev", "Minimum", "Maximum", "Variance","Skewness","Kurtosis"),]
stats_m<-basicStats(UK_m_r)[c("Mean", "Stdev", "Minimum", "Maximum", "Variance","Skewness","Kurtosis"),]
stats<-data.frame(cbind(stats_d, stats_m))
row.names(stats)<-c("Mean", "SD", "Minimum", "Maximum", "Variance","Skewness","Kurtosis")
colnames(stats)<-c('Daily', 'Monthly')
knitr::kable(stats)
```

```{r echo=FALSE, fig.pos='h'}
hist(UK_d_r, freq=F, breaks=365, main = 'Histograma de Log-retornos diarios', xlab = '')
lines(density(UK_d_r), col="red", )
lines(seq(min(UK_d_r), max(UK_d_r), length=length(UK_d_r)), dnorm(seq(min(UK_d_r), max(UK_d_r), length=length(UK_d_r)), mean(UK_d_r), sd(UK_d_r)), col="blue")
hist(UK_m_r, freq=F, breaks=12, main = 'Histograma de Log-retornos mensuales', ylim = c(0,12), xlab = '')
lines(density(UK_m_r), col="red", )
lines(seq(min(UK_m_r), max(UK_m_r), length=length(UK_m_r)), dnorm(seq(min(UK_m_r), max(UK_m_r), length=length(UK_m_r)), mean(UK_m_r), sd(UK_m_r)), col="blue")
```

  2. ¿Es el mercado accionario elegido eficiente? Use diferentes horizontes de tiempo y pruebe la hipótesis considerando sus diferentes formas. Discuta los resultados.

```{r}
############### IID (RW1) => MARTINGALE DIFFERENCE (RW2) => WHITE NOISE (RW3)

###### Testing RW3 
ggAcf(UK_d_r)
Box.test(UK_d_r, lag = 1, type = c("Ljung-Box"), fitdf = 0) 
Box.test(UK_d_r, lag = 1, type = c("Box-Pierce"), fitdf = 0)

bartels.rank.test(UK_d_r, pvalue="normal")

###### Testing RW1 
Lo.Mac(UK_d_r, c(2,50,200)) # it checks whether the VR = 1 for a given k to see whether the series is a random walk (which is the null hypothesis).

# M1 is the Lo.Mac statistic under the homoscedastic assumption. M2 is the Lo.Mac statistic under the heteroscedastic assumption. Better to look at M2 than M1 as M2 is based on a more realistic assumption. M1 and M2 are assumed to follow a normal distribution. So if M1 or M2 is greater than 1.96, you can reject the null hypothesis at 5% significant level.
```

```{r}
############### IID (RW1) => MARTINGALE DIFFERENCE (RW2) => WHITE NOISE (RW3)

###### Testing RW3 
ggAcf(UK_m_r)
Box.test(UK_m_r, lag = 1, type = c("Ljung-Box"), fitdf = 0) 
Box.test(UK_m_r, lag = 1, type = c("Box-Pierce"), fitdf = 0)

bartels.rank.test(UK_m_r, pvalue="normal")

###### Testing RW1 
Lo.Mac(UK_m_r, c(2,50,150)) # it checks whether the VR = 1 for a given k to see whether the series is a random walk (which is the null hypothesis).

# M1 is the Lo.Mac statistic under the homoscedastic assumption. M2 is the Lo.Mac statistic under the heteroscedastic assumption. Better to look at M2 than M1 as M2 is based on a more realistic assumption. M1 and M2 are assumed to follow a normal distribution. So if M1 or M2 is greater than 1.96, you can reject the null hypothesis at 5% significant level.
```








